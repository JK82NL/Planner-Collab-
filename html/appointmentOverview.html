<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../css/style.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8">
    
</head>

<body>

    <div class="container">
        <div class="row d-flex justify-content-center">
            <div class="col-6 mt-5 text-center">
                <!-- Placeholder for current date -->
                <p class="h3">Maandag 9 Juni 
            </div>
        </div>
        
        <div class="row d-flex justify-content-start">
            <div class="col-11 mt-5 overflow-auto" id="tableMain" style="height: 650px;">

            </div>
        </div>

        <!-- <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h5 class="class-title">Afspraak 1</h5>
                <p class="card-text">Lunch afspraak</p>
            </div>
        </div> -->

    </div>

    <script>

        const apptArray = [
        {
            apptTitle: "Afspraak 1",
            apptDesc: "Lunch afspraak collega",
            apptStart: "11:00",
            apptEnd: "12:30"
        },
        {
            apptTitle: "Tandarts",
            apptDesc: "Jaarlijkse check-up",
            apptStart: "14:00",
            apptEnd: "14:30"
        },
        {
            apptTitle: "Pauze",
            apptDesc: "Vrije tijd",
            apptStart: "10:30",
            apptEnd: "12:30"
        }

        ];


        let timestamps = [];

        generateTimestamps();

        function generateTimestamps() {
            let interval = 30;
            let minutesInDay = 24 * 60;


            for(let minutes = 0; minutes < minutesInDay; minutes += interval) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;

                // Formatting the time

                const formattedTime = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
                timestamps.push(formattedTime);
            };
            //console.log(timestamps);
        } 

        generateTimeTable();

        function generateTimeTable() {
            let table = document.createElement("table");
            table.className = "table";

            table.innerHTML = `
                <thead>
                    <tr>
                        <th scope="col">Time:</th>
                    </tr>
                </thead>
            `;
            document.getElementById("tableMain").appendChild(table);

            loopTimestamps(table);
 
        }

        function loopTimestamps(table) {
            let timeTable = document.createElement("tbody");

            timestamps.forEach(function(incTime, index) {
                let row = document.createElement("tr");

                let timeCell = document.createElement("th");
                timeCell.scope = "row";
                timeCell.innerText = incTime;
                row.appendChild(timeCell);

                let contentCell = document.createElement("td");

                let matchAppointment = apptArray.find(appt => appt.apptStart === incTime);

                if(matchAppointment) {
                    let duration = calculateDurationMins(matchAppointment.apptStart, matchAppointment.apptEnd);
                    let rowToSpan = duration / 30;

                    contentCell.rowSpan = rowToSpan;

                    contentCell.innerHTML = `
                        <div class="card" style="width: 18rem;">
                            <div class="card-body">
                                <h6 class="card-title">${matchAppointment.apptTitle}</h6>
                                <p class="card-text h6">${matchAppointment.apptDesc}</p>
                            </div>
                        </div>
                    `;

                    row.appendChild(contentCell);

                } else {
                    let isCovered = apptArray.some(appt => {
                        let startIndex = timestamps.indexOf(appt.apptStart);
                        let endIndex = timestamps.indexOf(appt.apptEnd);
                        return index > startIndex && index < endIndex;
                    });

                    if (!isCovered) {
                        row.appendChild(contentCell);
                    }
                }

                timeTable.appendChild(row);
            });
            table.appendChild(timeTable);
        }

        function calculateDurationMins(start, end) {
            let [startHour, startMin] = start.split(':').map(Number);
            let [endHour, endMin] = end.split(':').map(Number);
            console.log((endHour * 60 + endMin) - (startHour * 60 + startMin));
            return (endHour * 60 + endMin) - (startHour * 60 + startMin);
        }

    </script>

</body>